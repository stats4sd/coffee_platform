---
title: "State of the Smallholder Coffee farmer: Indicator Report"
output:
  pdf_document: 
    toc: true
    number_sections: true
    toc_depth: 1
date: "`r format(Sys.Time(), `%d, &B, %Y`)"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(tidyverse)
library(openxlsx)
library(kableExtra)
```

```{r}
data <- read.xlsx("Fake data.xlsx")
source("functions.R")
Indicators <- unique(data$Indicator)
```

```{r, results='asis'}
for(i in 1:length(Indicators)){
  
 data_x <- data%>%
    filter(Indicator == Indicators[i])   
 
cat("  \n#",  data_x$Indicator.name[1], "\n")    

cat("  \n##",  data_x$Indicator.name[1], ":Detail Table", "\n")  

print(kable(details_table(Indicators[i])) %>%
  column_spec(2, width = "28em")%>%
  collapse_rows())

cat('\n\n<!-- -->\n\n')

cat("  \n##",  data_x$Indicator.name[1], ":Value Table", "\n")  

print(kable(indicator_table(Indicators[i]))%>%
  column_spec(2, width = "15em")%>%
  collapse_rows(columns = 1))%>%
  
cat('\n\n<!-- -->\n\n')

cat("  \n##",  data_x$Indicator.name[1], ":Graphs", "\n")  

print(bar_graph(Indicators[i]))

cat('\n\n<!-- -->\n\n')

definition_table <- data_x%>%
  select(Source, Indicator.definition)%>%
  unique()

cat("  \n##",  "Definition by Source", "\n")  

print(kable(definition_table, row.names = FALSE, longtable = TRUE)%>%
  column_spec(1, width = "15em")%>%
  column_spec(2, width = "28em"))

cat('\n\n<!-- -->\n\n')
}

cat('\n\n<!-- -->\n\n')
```

